<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>API Validation Dashboard</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <h1>API Validation Dashboard</h1>
      <div class="header-info">
        <span id="environment" class="badge">Environment: Loading...</span>
        <span id="endpoint-count" class="badge">Endpoints: --</span>
        <span id="token-status" class="badge">Tokens: --</span>
        <button id="check-tokens-btn" class="btn btn-sm btn-secondary" onclick="App.checkTokens()" title="Validate tokens and refresh expired ones">
          ğŸ” Check Tokens
        </button>
        <button id="reload-swaggers-btn" class="btn btn-sm btn-secondary" onclick="App.reloadSwaggers()" title="Reload swagger files to pick up documentation changes">
          ğŸ”„ Reload Docs
        </button>
      </div>
    </header>

    <!-- Filters Section -->
    <section class="filters-section">
      <h2>Filters</h2>
      <div class="filters">
        <div class="filter-group">
          <label for="domain-filter">Domain:</label>
          <select id="domain-filter">
            <option value="">All</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="method-filter">Method:</label>
          <select id="method-filter">
            <option value="">All</option>
            <option value="GET">GET</option>
            <option value="POST">POST</option>
            <option value="PUT">PUT</option>
            <option value="PATCH">PATCH</option>
            <option value="DELETE">DELETE</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="token-filter">Token:</label>
          <select id="token-filter">
            <option value="">All</option>
            <option value="staff">Staff</option>
            <option value="directory">Directory</option>
            <option value="client">Client</option>
            <option value="business">Business</option>
            <option value="app">App</option>
          </select>
        </div>
        <div class="filter-group search-group">
          <label for="search-filter">Search:</label>
          <input type="text" id="search-filter" placeholder="Search endpoints...">
        </div>
      </div>
    </section>

    <!-- Rate Limiting Section -->
    <section class="rate-limit-section">
      <h2>Rate Limiting</h2>
      <div class="rate-limit-controls">
        <div class="filter-group">
          <label for="rate-preset">Preset:</label>
          <select id="rate-preset">
            <option value="conservative">Conservative (2 req/s)</option>
            <option value="normal" selected>Normal (5 req/s)</option>
            <option value="aggressive">Aggressive (20 req/s)</option>
            <option value="sequential">Sequential (1 req/s)</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="concurrent">Concurrent:</label>
          <input type="number" id="concurrent" min="1" max="20" value="3">
        </div>
        <div class="filter-group checkbox-group">
          <label>
            <input type="checkbox" id="retry-429" checked>
            Auto-retry 429
          </label>
        </div>
      </div>
    </section>

    <!-- Endpoints Section -->
    <section class="endpoints-section">
      <div class="endpoints-header">
        <h2>Endpoints <span id="selected-count">(0 selected)</span></h2>
        <div class="endpoints-actions">
          <a href="#" id="paste-endpoints-link" class="paste-endpoints-link" onclick="App.openPasteModal(); return false;">ğŸ“‹ Paste List</a>
          <button id="select-all-btn" class="btn btn-secondary">Select All</button>
          <button id="deselect-all-btn" class="btn btn-secondary">Deselect All</button>
          <button id="run-btn" class="btn btn-primary" disabled>Run Selected</button>
          <button id="stop-btn" class="btn btn-danger hidden">â¹ Stop</button>
        </div>
      </div>
      <div id="endpoints-list" class="endpoints-list">
        <div class="loading">Loading endpoints...</div>
      </div>
    </section>

    <!-- Progress Section -->
    <section id="progress-section" class="progress-section hidden">
      <h2>Test Progress</h2>
      <div class="progress-info">
        <span id="progress-text">Running: 0/0</span>
        <span id="progress-percent">0%</span>
      </div>
      <div class="progress-bar">
        <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
      </div>
      
      <!-- Pre-flight Section -->
      <div id="preflight-section" class="preflight-section hidden">
        <div class="preflight-header">
          <span class="preflight-icon">âš™ï¸</span>
          <span id="preflight-phase">Resolving parameters...</span>
          <span id="preflight-counter" class="preflight-counter">Analyzing...</span>
        </div>
        <div class="preflight-progress-row">
          <span id="preflight-progress" class="preflight-progress"></span>
          <span id="preflight-status" class="preflight-status"></span>
        </div>
        <div id="preflight-log" class="preflight-log"></div>
      </div>
      
      <div id="progress-log" class="progress-log"></div>
    </section>

    <!-- Results Section -->
    <section id="results-section" class="results-section hidden">
      <div class="results-header">
        <h2>Results</h2>
        <div class="results-summary">
          <span class="badge badge-pass">âœ… Passed: <span id="results-passed">0</span></span>
          <span class="badge badge-fail">âŒ Failed: <span id="results-failed">0</span></span>
          <span class="badge badge-warn">âš ï¸ Warned: <span id="results-warned">0</span></span>
          <span class="badge badge-error">ğŸ”¶ Errors: <span id="results-errored">0</span></span>
          <span class="badge badge-skip">â­ï¸ Skipped: <span id="results-skipped">0</span></span>
        </div>
        <div class="results-actions">
          <button id="preview-report-btn" class="btn btn-secondary" onclick="ResultsViewer.previewReport()">
            ğŸ“„ Preview Report
          </button>
          <button id="download-csv-btn" class="btn btn-secondary" onclick="ResultsViewer.downloadCSV()">
            ğŸ“Š Download CSV
          </button>
          <button id="save-full-report-btn" class="btn btn-primary" onclick="ResultsViewer.saveFullReport()">
            ğŸ’¾ Save Full Report
          </button>
        </div>
      </div>
      <div id="results-list" class="results-list"></div>
    </section>
  </div>

  <!-- Paste Endpoints Modal -->
  <div id="paste-endpoints-modal" class="modal hidden">
    <div class="modal-content paste-modal-content">
      <div class="modal-header">
        <h2>ğŸ“‹ Paste Endpoints List</h2>
        <div class="modal-actions">
          <button class="btn btn-primary" onclick="App.applyPastedEndpoints()">
            âœ“ Select Endpoints
          </button>
          <button class="btn btn-secondary" onclick="App.closePasteModal()">
            âœ• Close
          </button>
        </div>
      </div>
      <div class="modal-body paste-modal-body">
        <p class="paste-instructions">
          Paste a comma-separated list of endpoints to select them for testing. 
          Format: <code>METHOD /path</code> (e.g., <code>GET /v1/clients, POST /v1/payments</code>)
        </p>
        <textarea id="paste-endpoints-input" class="paste-textarea" placeholder="GET /v1/clients, POST /v1/payments, PUT /v1/invoices/{id}"></textarea>
        <div id="paste-preview" class="paste-preview hidden">
          <span class="preview-label">Will select:</span>
          <span id="paste-match-count" class="preview-count">0 endpoints</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Report Preview Modal -->
  <div id="report-modal" class="modal hidden">
    <div class="modal-content report-modal-content">
      <div class="modal-header">
        <h2>ğŸ“„ Validation Report</h2>
        <div class="modal-actions">
          <button class="btn btn-primary" onclick="ResultsViewer.downloadReportFromModal()">
            â¬‡ï¸ Download MD
          </button>
          <button class="btn btn-secondary" onclick="ResultsViewer.closeReportModal()">
            âœ• Close
          </button>
        </div>
      </div>
      <div id="report-preview" class="report-preview markdown-body"></div>
    </div>
  </div>

  <script src="js/app.js"></script>
  <script src="js/endpoint-list.js"></script>
  <script src="js/test-runner.js"></script>
  <script src="js/results-viewer.js"></script>
</body>
</html>
