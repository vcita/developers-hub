---
description: Swagger API development standards and conventions
globs: swagger/**/*.json
alwaysApply: true
---
# API v3 REST Standards
## Standards must be followed!
## When the developing a Swagger API defention, follow the standars listed on our confluence: @https://myvcita.atlassian.net/wiki/spaces/IT/pages/3774841078/API+v3+REST+Standards

## Request/Response Schemas
- Define request schemas separately from entity (e.g., `CreateBusinessPhoneNumberRequest`)
- Request schemas should only include user-editable fields
- Reference entities via GitHub Pages URL: `https://vcita.github.io/developers-hub/entities/{domain}/{entityName}.json`

## Error Responses
- **400 Bad Request**: Malformed requests or invalid syntax
- **422 Unprocessable Entity**: Validation errors with valid syntax
- Include `field` property in errors to identify which field failed

## Documentation Standards
- Token permissions in bold: `Available for **Staff and Directory tokens**`

## Conditional Validation
- Use `allOf`/`if`/`then` for conditional requirements
- Only add conditionally required fields, don't duplicate base required fields

## Avoid
- Don't inline large schemas - extract to entity files
- Don't duplicate schema definitions - use `$ref`

## Example: Request Schema (excludes readonly fields)

```json
{
  "CreateBusinessPhoneNumberRequest": {
    "type": "object",
    "properties": {
      "phone_number": {
        "type": "string",
        "description": "The complete phone number in E.164 format without + prefix (e.g., \"12127654321\")."
      },
      "country_code": {
        "type": "string",
        "pattern": "^[A-Z]{2}$",
        "description": "ISO 3166-1 alpha-2 country code (e.g., \"US\", \"GB\")."
      }
    },
    "required": ["phone_number", "country_code"]
  }
}
```

Note: `uid`, `business_uid`, `created_at`, `updated_at` are omitted - they are backend-managed.

## Example: Response Schema with Entity Reference

```json
{
  "200": {
    "description": "Resource retrieved successfully.",
    "content": {
      "application/json": {
        "schema": {
          "allOf": [
            {
              "$ref": "https://vcita.github.io/developers-hub/entities/response.json"
            },
            {
              "properties": {
                "data": {
                  "$ref": "https://vcita.github.io/developers-hub/entities/{domain}/{entityName}.json"
                }
              }
            }
          ]
        }
      }
    }
  }
}
```

## Example: Error Response

```json
{
  "422": {
    "description": "Unprocessable Entity - Validation error.",
    "content": {
      "application/json": {
        "schema": {
          "$ref": "#/components/schemas/ErrorResponse"
        },
        "example": {
          "success": false,
          "errors": [
            {
              "field": "phone_number",
              "code": "invalid",
              "message": "Phone number format is invalid"
            }
          ]
        }
      }
    }
  }
}
```
