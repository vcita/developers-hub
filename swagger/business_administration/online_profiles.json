{
  "openapi": "3.0.0",
  "info": {
    "title": "Online Profiles API",
    "description": "API for managing business online profile settings including supported languages and privacy policy configuration.",
    "version": "3.0.0"
  },
  "servers": [
    {
      "url": "https://api.vcita.biz/v3/business_administration"
    }
  ],
  "paths": {
    "/online_profiles/{business_uid}": {
      "get": {
        "summary": "Get Online Profile",
        "description": "Retrieve the online profile for a specific business. This is a **public endpoint** that does not require authentication.\n\nNote: Returns 200 with null data even if business doesn't exist.",
        "operationId": "getOnlineProfilePublic",
        "parameters": [
          {
            "name": "business_uid",
            "in": "path",
            "required": true,
            "description": "The unique identifier of the business.",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Online profile retrieved successfully. Data will be null if no profile exists or business not found.",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "https://vcita.github.io/developers-hub/entities/response.json"
                    },
                    {
                      "properties": {
                        "data": {
                          "type": "object",
                          "properties": {
                            "online_profile": {
                              "oneOf": [
                                {
                                  "$ref": "#/components/schemas/OnlineProfile"
                                },
                                {
                                  "type": "null"
                                }
                              ]
                            }
                          }
                        }
                      }
                    }
                  ]
                },
                "examples": {
                  "with_link_policy": {
                    "summary": "Profile with link-type privacy policy",
                    "value": {
                      "success": true,
                      "data": {
                        "online_profile": {
                          "uid": "abc123",
                          "business_uid": "d290f1ee26c54",
                          "supported_languages": ["en", "es"],
                          "privacy_policy": {
                            "type": "link",
                            "url": "https://example.com/privacy",
                            "content": null
                          },
                          "created_at": "2026-01-12T10:30:00Z",
                          "updated_at": "2026-01-12T10:30:00Z"
                        }
                      }
                    }
                  },
                  "with_text_policy": {
                    "summary": "Profile with text-type privacy policy",
                    "value": {
                      "success": true,
                      "data": {
                        "online_profile": {
                          "uid": "abc123",
                          "business_uid": "d290f1ee26c54",
                          "supported_languages": ["en"],
                          "privacy_policy": {
                            "type": "text",
                            "url": null,
                            "content": "We respect your privacy and are committed to protecting your personal data..."
                          },
                          "created_at": "2026-01-12T10:30:00Z",
                          "updated_at": "2026-01-12T10:30:00Z"
                        }
                      }
                    }
                  },
                  "no_policy": {
                    "summary": "Profile without privacy policy configured",
                    "value": {
                      "success": true,
                      "data": {
                        "online_profile": {
                          "uid": "abc123",
                          "business_uid": "d290f1ee26c54",
                          "supported_languages": ["en"],
                          "privacy_policy": null,
                          "created_at": "2026-01-12T10:30:00Z",
                          "updated_at": "2026-01-12T10:30:00Z"
                        }
                      }
                    }
                  },
                  "not_found": {
                    "summary": "Business not found or no profile",
                    "value": {
                      "success": true,
                      "data": {
                        "online_profile": null
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "tags": ["Online Profiles"]
      }
    },
    "/online_profiles": {
      "get": {
        "summary": "List Online Profiles",
        "description": "Retrieve the online profile for the business associated with the authenticated token. Available for **Staff tokens only**.",
        "operationId": "listOnlineProfiles",
        "responses": {
          "200": {
            "description": "Online profiles retrieved successfully.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "online_profiles": {
                          "oneOf": [
                            {
                              "type": "array",
                              "items": {
                                "$ref": "#/components/schemas/OnlineProfile"
                              }
                            },
                            {
                              "type": "null"
                            }
                          ]
                        }
                      }
                    }
                  }
                },
                "examples": {
                  "with_profile": {
                    "summary": "Online profile exists",
                    "value": {
                      "success": true,
                      "data": {
                        "online_profiles": [
                          {
                            "uid": "abc123",
                            "business_uid": "d290f1ee26c54",
                            "supported_languages": ["en", "es"],
                            "privacy_policy": {
                              "type": "link",
                              "url": "https://example.com/privacy",
                              "content": null
                            },
                            "created_at": "2026-01-12T10:30:00Z",
                            "updated_at": "2026-01-12T10:30:00Z"
                          }
                        ]
                      }
                    }
                  },
                  "no_profile": {
                    "summary": "No online profile configured",
                    "value": {
                      "success": true,
                      "data": {
                        "online_profiles": null
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "success": false,
                  "errors": [
                    {
                      "code": "unauthorized",
                      "message": "Authentication required"
                    }
                  ]
                }
              }
            }
          }
        },
        "tags": ["Online Profiles"],
        "security": [
          {
            "Bearer": []
          }
        ]
      },
      "post": {
        "summary": "Create Online Profile",
        "description": "Create a new online profile for the business. The business is determined from the authenticated token. Available for **Staff tokens** with `can_access_admin_account?` permission.",
        "operationId": "createOnlineProfile",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateOnlineProfileRequest"
              },
              "examples": {
                "with_languages": {
                  "summary": "Create with supported languages only",
                  "value": {
                    "supported_languages": ["en", "es", "fr"]
                  }
                },
                "with_link_policy": {
                  "summary": "Create with link-type privacy policy",
                  "value": {
                    "supported_languages": ["en"],
                    "privacy_policy": {
                      "type": "link",
                      "url": "https://example.com/privacy"
                    }
                  }
                },
                "with_text_policy": {
                  "summary": "Create with text-type privacy policy",
                  "value": {
                    "supported_languages": ["en"],
                    "privacy_policy": {
                      "type": "text",
                      "content": "We respect your privacy and are committed to protecting your personal data..."
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Online profile created successfully.",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "https://vcita.github.io/developers-hub/entities/response.json"
                    },
                    {
                      "properties": {
                        "data": {
                          "$ref": "#/components/schemas/OnlineProfile"
                        }
                      }
                    }
                  ]
                },
                "example": {
                  "success": true,
                  "data": {
                    "uid": "abc123",
                    "business_uid": "d290f1ee26c54",
                    "supported_languages": ["en", "es"],
                    "privacy_policy": {
                      "type": "text",
                      "url": null,
                      "content": "We respect your privacy..."
                    },
                    "created_at": "2026-01-12T10:30:00Z",
                    "updated_at": "2026-01-12T10:30:00Z"
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Client token or missing authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "success": false,
                  "errors": [
                    {
                      "code": "unauthorized",
                      "message": "Client is not authorized"
                    }
                  ]
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Staff token lacks required permission",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "success": false,
                  "errors": [
                    {
                      "code": "forbidden",
                      "message": "Access denied"
                    }
                  ]
                }
              }
            }
          },
          "409": {
            "description": "Conflict - Online profile already exists for this business",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "success": false,
                  "errors": [
                    {
                      "code": "conflict",
                      "message": "Online profile already exists for this business"
                    }
                  ]
                }
              }
            }
          },
          "422": {
            "description": "Unprocessable Entity - Validation error.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "examples": {
                  "invalid_url": {
                    "summary": "Invalid URL format",
                    "value": {
                      "success": false,
                      "errors": [
                        {
                          "field": "privacy_policy.url",
                          "code": "invalid",
                          "message": "URL must be a valid HTTP or HTTPS URL"
                        }
                      ]
                    }
                  },
                  "content_too_long": {
                    "summary": "Content exceeds maximum length",
                    "value": {
                      "success": false,
                      "errors": [
                        {
                          "field": "privacy_policy.content",
                          "code": "invalid",
                          "message": "Content exceeds maximum length of 40,000 characters"
                        }
                      ]
                    }
                  }
                }
              }
            }
          }
        },
        "tags": ["Online Profiles"],
        "security": [
          {
            "Bearer": []
          }
        ]
      }
    },
    "/online_profiles/{uid}": {
      "put": {
        "summary": "Update Online Profile",
        "description": "Update an existing online profile. Available for **Staff tokens** with `can_access_admin_account?` permission.",
        "operationId": "updateOnlineProfile",
        "parameters": [
          {
            "name": "uid",
            "in": "path",
            "required": true,
            "description": "The unique identifier of the online profile.",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateOnlineProfileRequest"
              },
              "examples": {
                "update_languages": {
                  "summary": "Update supported languages only",
                  "value": {
                    "supported_languages": ["en", "es", "de"]
                  }
                },
                "set_link_policy": {
                  "summary": "Set link-type privacy policy",
                  "value": {
                    "privacy_policy": {
                      "type": "link",
                      "url": "https://newsite.com/privacy-policy"
                    }
                  }
                },
                "set_text_policy": {
                  "summary": "Set text-type privacy policy",
                  "value": {
                    "privacy_policy": {
                      "type": "text",
                      "content": "Updated privacy policy content..."
                    }
                  }
                },
                "clear_policy": {
                  "summary": "Clear privacy policy (set url or content to null depending on type)",
                  "value": {
                    "privacy_policy": {
                      "url": null
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Online profile updated successfully.",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "https://vcita.github.io/developers-hub/entities/response.json"
                    },
                    {
                      "properties": {
                        "data": {
                          "$ref": "#/components/schemas/OnlineProfile"
                        }
                      }
                    }
                  ]
                },
                "example": {
                  "success": true,
                  "data": {
                    "uid": "abc123",
                    "business_uid": "d290f1ee26c54",
                    "supported_languages": ["en", "es"],
                    "privacy_policy": {
                      "type": "link",
                      "url": "https://newsite.com/privacy-policy",
                      "content": null
                    },
                    "created_at": "2026-01-12T10:30:00Z",
                    "updated_at": "2026-01-12T14:00:00Z"
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Client token or missing authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "success": false,
                  "errors": [
                    {
                      "code": "unauthorized",
                      "message": "Client is not authorized"
                    }
                  ]
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Staff token lacks required permission",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "success": false,
                  "errors": [
                    {
                      "code": "forbidden",
                      "message": "Access denied"
                    }
                  ]
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Online profile not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "success": false,
                  "errors": [
                    {
                      "code": "not_found",
                      "message": "Online profile not found"
                    }
                  ]
                }
              }
            }
          },
          "422": {
            "description": "Unprocessable Entity - Validation error.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "examples": {
                  "invalid_url": {
                    "summary": "Invalid URL format",
                    "value": {
                      "success": false,
                      "errors": [
                        {
                          "field": "privacy_policy.url",
                          "code": "invalid",
                          "message": "URL must be a valid HTTP or HTTPS URL"
                        }
                      ]
                    }
                  },
                  "content_too_long": {
                    "summary": "Content exceeds maximum length",
                    "value": {
                      "success": false,
                      "errors": [
                        {
                          "field": "privacy_policy.content",
                          "code": "invalid",
                          "message": "Content exceeds maximum length of 40,000 characters"
                        }
                      ]
                    }
                  }
                }
              }
            }
          }
        },
        "tags": ["Online Profiles"],
        "security": [
          {
            "Bearer": []
          }
        ]
      }
    }
  },
  "components": {
    "securitySchemes": {
      "Bearer": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "description": "JWT token for authentication. Staff tokens required for authenticated endpoints."
      }
    },
    "schemas": {
      "PrivacyPolicyInput": {
        "type": "object",
        "description": "Privacy policy configuration input. Set type to null to clear the privacy policy.",
        "properties": {
          "type": {
            "type": "string",
            "enum": ["link", "text"],
            "nullable": true,
            "description": "The type of privacy policy configuration. 'link': External URL pointing to the business's privacy policy page. 'text': Inline privacy policy content that will be displayed in a modal. Set to null to clear the privacy policy."
          },
          "url": {
            "type": "string",
            "format": "uri",
            "description": "External URL to the privacy policy page. Used when type is 'link' (e.g., \"https://example.com/privacy\")."
          },
          "content": {
            "type": "string",
            "maxLength": 40000,
            "description": "Inline privacy policy text content. Used when type is 'text'. Maximum 40,000 characters."
          }
        }
      },
      "CreateOnlineProfileRequest": {
        "type": "object",
        "properties": {
          "supported_languages": {
            "type": "array",
            "description": "List of ISO 639-1 language codes supported by the business for client-facing content (e.g., [\"en\", \"es\", \"en-GB\"]).",
            "items": {
              "type": "string",
              "pattern": "^[a-z]{2}(-[A-Z]{2})?$"
            },
            "uniqueItems": true
          },
          "privacy_policy": {
            "$ref": "#/components/schemas/PrivacyPolicyInput"
          }
        }
      },
      "UpdateOnlineProfileRequest": {
        "type": "object",
        "properties": {
          "supported_languages": {
            "type": "array",
            "description": "List of ISO 639-1 language codes supported by the business for client-facing content (e.g., [\"en\", \"es\", \"en-GB\"]).",
            "items": {
              "type": "string",
              "pattern": "^[a-z]{2}(-[A-Z]{2})?$"
            },
            "uniqueItems": true
          },
          "privacy_policy": {
            "$ref": "#/components/schemas/PrivacyPolicyInput"
          }
        }
      },
      "OnlineProfile": {
        "$ref": "https://vcita.github.io/developers-hub/entities/business_administration/onlineProfile.json"
      },
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "errors": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "field": {
                  "type": "string",
                  "description": "The field that caused the error (for validation errors)"
                },
                "code": {
                  "type": "string"
                },
                "message": {
                  "type": "string"
                }
              },
              "required": ["code", "message"]
            }
          }
        },
        "required": ["success", "errors"]
      }
    }
  }
}

