{
  "swagger": "2.0",
  "basePath": "/business/search/v1",
  "host": "api.vcita.biz",
  "info": {
    "title": "CRM Views",
    "description": "API endpoints for managing views, view columns, and view filters in the vcita business search interface",
    "version": "1.0"
  },
  "securityDefinitions": {
    "Bearer": {
      "type": "apiKey",
      "name": "Authorization",
      "in": "header",
      "description": "Provide a valid bearer token in the Authorization header. Example: 'Authorization: Bearer {app_token}'"
    }
  },
  "definitions": {
    "Response": {
      "type": "object",
      "properties": {
        "success": {
          "type": "boolean"
        },
        "data": {
          "type": "object"
        }
      },
      "required": [
        "success",
        "data"
      ]
    },
    "View": {
      "type": "object",
      "properties": {
        "uid": {
          "type": "string",
          "description": "Unique identifier for the view"
        },
        "name": {
          "type": "string",
          "description": "View name"
        },
        "description": {
          "type": "string",
          "description": "View description"
        },
        "view_type": {
          "type": "string",
          "enum": ["client", "account"],
          "description": "Type of view"
        },
        "level": {
          "type": "string",
          "enum": ["business", "staff", "user"],
          "description": "View level"
        },
        "columns": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/ViewColumn"
          },
          "description": "Array of column definitions"
        },
        "filter": {
          "type": "string",
          "description": "Filter configuration as JSON string"
        },
        "sorting_column": {
          "type": "string",
          "description": "Column to sort by"
        },
        "sorting_direction": {
          "type": "string",
          "enum": ["asc", "desc"],
          "description": "Sort direction"
        },
        "order": {
          "type": "integer",
          "description": "View order"
        },
        "pinned": {
          "type": "boolean",
          "description": "Whether the view is displayed"
        }
      }
    },
    "ViewColumn": {
      "type": "object",
      "properties": {
        "label": {
          "type": "string",
          "description": "Column label"
        },
        "type": {
          "type": "string",
          "description": "Column type"
        },
        "identifier": {
          "type": "string",
          "description": "Column identifier"
        },
        "sortable": {
          "type": "boolean",
          "description": "Whether column is sortable"
        },
        "sort_options": {
          "type": "object",
          "description": "Sort options for the column"
        }
      },
      "required": ["label", "type", "identifier", "sortable"]
    },
    "ViewFilter": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "description": "Filter name/key"
        },
        "label": {
          "type": "string",
          "description": "Filter display label"
        },
        "type": {
          "type": "string",
          "enum": ["text", "boolean", "multiselect", "singleselect", "date", "tags", "sources", "review", "smart"],
          "description": "Filter input type"
        },
        "key": {
          "type": "string",
          "description": "Filter key for API usage"
        },
        "options": {
          "type": "object",
          "properties": {
            "values": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "id": {
                    "type": "string"
                  },
                  "display_value": {
                    "type": "string"
                  }
                }
              }
            },
            "description": {
              "type": "string",
              "description": "Filter description for smart filters"
            }
          }
        }
      },
      "required": ["label", "type", "key"]
    },
    "ViewFilterCategory": {
      "type": "object",
      "properties": {
        "category": {
          "type": "string",
          "description": "Category identifier"
        },
        "label": {
          "type": "string",
          "description": "Category display label"
        },
        "order": {
          "type": "integer",
          "description": "Category display order"
        },
        "filters": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/ViewFilter"
          },
          "description": "Filters in this category"
        }
      },
      "required": ["category", "label", "order", "filters"]
    }
  },
  "paths": {
    "/views": {
      "get": {
        "summary": "Get all views",
        "description": "Retrieve all views for the authenticated business - Available for **Staff Tokens**",
        "parameters": [
          {
            "name": "pinned",
            "in": "query",
            "type": "boolean",
            "description": "Filter by displayed views",
            "required": false
          },
          {
            "name": "Authorization",
            "in": "header",
            "type": "string",
            "description": "The format of the API authorization header should be: 'Authorization': \"Bearer API_TOKEN\"",
            "required": true,
            "x-example": "Bearer abc...123"
          }
        ],
        "produces": [
          "application/json"
        ],
        "responses": {
          "200": {
            "description": "Success",
            "examples": {
              "application/json": {
                "success": true,
                "data": {
                  "views": [
                    {
                      "uid": "abc123def456",
                      "name": "All Clients",
                      "description": "View showing all active clients",
                      "view_type": "client",
                      "level": "business",
                      "columns": [
                        {
                          "label": "Client Name",
                          "type": "ContactFullName",
                          "identifier": "contact_full_name",
                          "sortable": true,
                          "sort_options": {}
                        },
                        {
                          "label": "Email",
                          "type": "Email",
                          "identifier": "email",
                          "sortable": false,
                          "sort_options": {}
                        },
                        {
                          "label": "Created At",
                          "type": "CreationDate",
                          "identifier": "created_at",
                          "sortable": true,
                          "sort_options": {}
                        }
                      ],
                      "filter": "[{\"key\":\"fields_filter.first_name\",\"label\":\"First Name\",\"value\":\"John\",\"type\":\"text\"}]",
                      "sorting_column": "matter_name",
                      "sorting_direction": "desc",
                      "order": 1,
                      "pinned": true
                    }
                  ]
                }
              }
            }
          }
        },
        "security": [
          {
            "Bearer": []
          }
        ],
        "tags": ["Views"]
      },
      "post": {
        "summary": "Create a new view",
        "description": "Create a new custom view - Available for **Staff Tokens**",
        "consumes": [
          "application/json"
        ],
        "produces": [
          "application/json"
        ],
        "parameters": [
          {
            "name": "Authorization",
            "in": "header",
            "type": "string",
            "description": "The format of the API authorization header should be: 'Authorization': \"Bearer API_TOKEN\"",
            "required": true,
            "x-example": "Bearer abc...123"
          },
          {
            "in": "body",
            "name": "body",
            "schema": {
              "type": "object",
              "properties": {
                "view": {
                  "type": "object",
                  "properties": {
                    "level": {
                      "type": "string",
                      "enum": ["business", "staff", "user"],
                      "description": "View level (business, staff, or user)"
                    },
                    "view_type": {
                      "type": "string",
                      "enum": ["client", "account"],
                      "description": "Type of view (client or account)"
                    },
                    "columns": {
                      "type": "array",
                      "items": {
                        "$ref": "#/definitions/ViewColumn"
                      },
                      "description": "Array of column definitions"
                    },
                    "sorting_column": {
                      "type": "string",
                      "description": "Column to sort by"
                    },
                    "sorting_direction": {
                      "type": "string",
                      "enum": ["asc", "desc"],
                      "description": "Sort direction (asc or desc)"
                    },
                    "filter": {
                      "type": "string",
                      "description": "Filter configuration as JSON string"
                    },
                    "name": {
                      "type": "string",
                      "description": "View name"
                    },
                    "description": {
                      "type": "string",
                      "description": "View description"
                    },
                    "order": {
                      "type": "integer",
                      "description": "View order"
                    }
                  },
                  "required": ["level", "view_type", "columns", "sorting_column", "sorting_direction", "filter", "name", "description", "order"]
                }
              },
              "required": ["view"]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Success",
            "examples": {
              "application/json": {
                "success": true,
                "data": {
                  "view": {
                    "uid": "new456abc789",
                    "name": "Custom Client View",
                    "description": "My custom view for clients",
                    "view_type": "client",
                    "level": "staff",
                    "columns": [
                      {
                        "label": "Client Name",
                        "type": "ContactFullName",
                        "identifier": "contact_full_name",
                        "sortable": true,
                        "sort_options": {}
                      },
                      {
                        "label": "Phone",
                        "type": "Phone",
                        "identifier": "phone",
                        "sortable": false,
                        "sort_options": {}
                      }
                    ],
                    "filter": "[]",
                    "sorting_column": "contact_full_name",
                    "sorting_direction": "asc",
                    "order": 5,
                    "pinned": false
                  }
                }
              }
            }
          }
        },
        "security": [
          {
            "Bearer": []
          }
        ],
        "tags": ["Views"]
      }
    },
    "/views/{uid}": {
      "get": {
        "summary": "Get a specific view",
        "description": "Retrieve a specific view by UID - Available for **Staff Tokens**",
        "parameters": [
          {
            "name": "uid",
            "in": "path",
            "required": true,
            "type": "string",
            "description": "View UID"
          },
          {
            "name": "type",
            "in": "query",
            "required": false,
            "type": "string",
            "enum": ["system", "custom"],
            "description": "View type (system or custom)"
          },
          {
            "name": "Authorization",
            "in": "header",
            "type": "string",
            "description": "The format of the API authorization header should be: 'Authorization': \"Bearer API_TOKEN\"",
            "required": true,
            "x-example": "Bearer abc...123"
          }
        ],
        "produces": [
          "application/json"
        ],
        "responses": {
          "200": {
            "description": "Success",
            "examples": {
              "application/json": {
                "success": true,
                "data": {
                  "view": {
                    "uid": "abc123def456",
                    "name": "All Clients",
                    "description": "View showing all active clients",
                    "view_type": "client",
                    "level": "business",
                    "columns": [
                      {
                        "label": "Client Name",
                        "type": "ContactFullName",
                        "identifier": "contact_full_name",
                        "sortable": true,
                        "sort_options": {}
                      },
                      {
                        "label": "Email",
                        "type": "Email",
                        "identifier": "email",
                        "sortable": false,
                        "sort_options": {}
                      }
                    ],
                    "filter": "[{\"key\":\"fields_filter.first_name\",\"label\":\"First Name\",\"value\":\"John\",\"type\":\"text\"}]",
                    "sorting_column": "matter_name",
                    "sorting_direction": "desc",
                    "order": 1,
                    "pinned": true
                  }
                }
              }
            }
          }
        },
        "security": [
          {
            "Bearer": []
          }
        ],
        "tags": ["Views"]
      },
      "put": {
        "summary": "Update a view",
        "description": "Update an existing view - Available for **Staff Tokens**",
        "consumes": [
          "application/json"
        ],
        "produces": [
          "application/json"
        ],
        "parameters": [
          {
            "name": "uid",
            "in": "path",
            "required": true,
            "type": "string",
            "description": "View UID"
          },
          {
            "name": "Authorization",
            "in": "header",
            "type": "string",
            "description": "The format of the API authorization header should be: 'Authorization': \"Bearer API_TOKEN\"",
            "required": true,
            "x-example": "Bearer abc...123"
          },
          {
            "in": "body",
            "name": "body",
            "schema": {
              "type": "object",
              "properties": {
                "view": {
                  "type": "object",
                  "properties": {
                    "level": {
                      "type": "string",
                      "enum": ["business", "staff", "user"],
                      "description": "View level (business, staff, or user)"
                    },
                    "name": {
                      "type": "string",
                      "description": "View name"
                    },
                    "columns": {
                      "type": "array",
                      "items": {
                        "$ref": "#/definitions/ViewColumn"
                      }
                    },
                    "filter": {
                      "type": "string",
                      "description": "Filter configuration"
                    }
                  }
                }
              },
              "required": ["view"]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Success",
            "examples": {
              "application/json": {
                "success": true,
                "data": {
                  "view": {
                    "uid": "abc123def456",
                    "name": "Updated View Name",
                    "description": "Updated description",
                    "view_type": "client",
                    "level": "staff",
                    "columns": [
                      {
                        "label": "Client Name",
                        "type": "ContactFullName",
                        "identifier": "contact_full_name",
                        "sortable": true,
                        "sort_options": {}
                      },
                      {
                        "label": "Tags",
                        "type": "Tags",
                        "identifier": "tags",
                        "sortable": false,
                        "sort_options": {}
                      }
                    ],
                    "filter": "[{\"key\":\"tags_filter\",\"label\":\"Tags\",\"value\":[\"important\"],\"type\":\"tags\"}]",
                    "sorting_column": "contact_full_name",
                    "sorting_direction": "asc",
                    "order": 2,
                    "pinned": false
                  }
                }
              }
            }
          }
        },
        "security": [
          {
            "Bearer": []
          }
        ],
        "tags": ["Views"]
      },
      "delete": {
        "summary": "Delete a view",
        "description": "Delete a custom view - Available for **Staff Tokens**",
        "parameters": [
          {
            "name": "uid",
            "in": "path",
            "required": true,
            "type": "string",
            "description": "View UID"
          },
          {
            "name": "Authorization",
            "in": "header",
            "type": "string",
            "description": "The format of the API authorization header should be: 'Authorization': \"Bearer API_TOKEN\"",
            "required": true,
            "x-example": "Bearer abc...123"
          }
        ],
        "produces": [
          "application/json"
        ],
        "responses": {
          "200": {
            "description": "Success",
            "examples": {
              "application/json": {
                "success": true,
                "data": {
                  "message": "View deleted successfully"
                }
              }
            }
          }
        },
        "security": [
          {
            "Bearer": []
          }
        ],
        "tags": ["Views"]
      }
    },
    "/views/bulk": {
      "post": {
        "summary": "Bulk update views",
        "description": "Update multiple views in bulk - Available for **Staff Tokens**",
        "consumes": [
          "application/json"
        ],
        "produces": [
          "application/json"
        ],
        "parameters": [
          {
            "name": "Authorization",
            "in": "header",
            "type": "string",
            "description": "The format of the API authorization header should be: 'Authorization': \"Bearer API_TOKEN\"",
            "required": true,
            "x-example": "Bearer abc...123"
          },
          {
            "in": "body",
            "name": "body",
            "schema": {
              "type": "object",
              "properties": {
                "views": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "uid": {
                        "type": "string",
                        "description": "View UID"
                      },
                      "updates": {
                        "type": "object",
                        "description": "Updates to apply",
                        "properties": {
                          "pinned": {
                            "type": "boolean"
                          },
                          "order": {
                            "type": "integer"
                          },
                          "name": {
                            "type": "string"
                          }
                        }
                      }
                    },
                    "required": ["uid", "updates"]
                  }
                }
              },
              "required": ["views"]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Success",
            "examples": {
              "application/json": {
                "success": true,
                "data": {
                  "message": "Views updated successfully"
                }
              }
            }
          }
        },
        "security": [
          {
            "Bearer": []
          }
        ],
        "tags": ["Views"]
      }
    },
    "/views_columns": {
      "get": {
        "summary": "Get available columns",
        "description": "Retrieve all available columns for creating views - Available for **Staff Tokens**",
        "parameters": [
          {
            "name": "Authorization",
            "in": "header",
            "type": "string",
            "description": "The format of the API authorization header should be: 'Authorization': \"Bearer API_TOKEN\"",
            "required": true,
            "x-example": "Bearer abc...123"
          }
        ],
        "produces": [
          "application/json"
        ],
        "responses": {
          "200": {
            "description": "Success",
            "examples": {
              "application/json": {
                "success": true,
                "data": {
                  "columns": [
                    {
                      "label": "Client Name",
                      "type": "ContactFullName",
                      "identifier": "contact_full_name",
                      "sortable": true,
                      "sort_options": {}
                    },
                    {
                      "label": "Email",
                      "type": "Email",
                      "identifier": "email",
                      "sortable": false,
                      "sort_options": {}
                    },
                    {
                      "label": "Phone",
                      "type": "Phone",
                      "identifier": "phone",
                      "sortable": false,
                      "sort_options": {}
                    },
                    {
                      "label": "Created At",
                      "type": "CreationDate",
                      "identifier": "created_at",
                      "sortable": true,
                      "sort_options": {}
                    },
                    {
                      "label": "Tags",
                      "type": "Tags",
                      "identifier": "tags",
                      "sortable": false,
                      "sort_options": {}
                    },
                    {
                      "label": "Last Activity",
                      "type": "LastActivityTime",
                      "identifier": "last_interaction",
                      "sortable": true,
                      "sort_options": {}
                    },
                    {
                      "label": "Review Score",
                      "type": "ReviewScore",
                      "identifier": "review_score",
                      "sortable": true,
                      "sort_options": {}
                    },
                    {
                      "label": "Contact Image",
                      "type": "ContactImage",
                      "identifier": "photo_path",
                      "sortable": true,
                      "sort_options": {}
                    },
                    {
                      "label": "Contact Status",
                      "type": "ContactStatus",
                      "identifier": "contact_status",
                      "sortable": false,
                      "sort_options": {}
                    },
                    {
                      "label": "Assigned Staff",
                      "type": "Staff",
                      "identifier": "contact_assigned_staff_uid",
                      "sortable": false,
                      "sort_options": {}
                    }
                  ]
                }
              }
            }
          }
        },
        "security": [
          {
            "Bearer": []
          }
        ],
        "tags": ["Views Columns"]
      }
    },
    "/view_filters": {
      "get": {
        "summary": "Get available filters",
        "description": "Retrieve all available filters for creating views - Available for **Staff Tokens**",
        "parameters": [
          {
            "name": "Authorization",
            "in": "header",
            "type": "string",
            "description": "The format of the API authorization header should be: 'Authorization': \"Bearer API_TOKEN\"",
            "required": true,
            "x-example": "Bearer abc...123"
          }
        ],
        "produces": [
          "application/json"
        ],
        "responses": {
          "200": {
            "description": "Success",
            "examples": {
              "application/json": {
                "success": true,
                "data": {
                  "filters": [
                    {
                      "category": "popular",
                      "label": "Popular Filters",
                      "order": 1,
                      "filters": [
                        {
                          "name": "contact_full_name",
                          "label": "Contact Full Name",
                          "type": "text",
                          "key": "fields_filter.first_name",
                          "options": {}
                        },
                        {
                          "name": "client_status",
                          "label": "Client Status",
                          "type": "multiselect",
                          "key": "client_data_associated_with_field_filter.status",
                          "options": {
                            "values": [
                              {"id": "lead", "display_value": "Lead"},
                              {"id": "customer", "display_value": "Customer"},
                              {"id": "loyal", "display_value": "Loyal"},
                              {"id": "inactive", "display_value": "Inactive"}
                            ]
                          }
                        },
                        {
                          "name": "tags",
                          "label": "Tags",
                          "type": "tags",
                          "key": "tags_filter",
                          "options": {
                            "values": ["important", "follow-up", "new-client"]
                          }
                        },
                        {
                          "name": "assigned_staff",
                          "label": "Assigned Staff",
                          "type": "singleselect",
                          "key": "fields_filter.staff_ids",
                          "options": {
                            "values": [
                              {"id": "1", "display_value": "John Smith"},
                              {"id": "2", "display_value": "Jane Doe"}
                            ]
                          }
                        },
                        {
                          "name": "created_at",
                          "label": "Created At",
                          "type": "date",
                          "key": "created_at_filter",
                          "options": {}
                        }
                      ]
                    },
                    {
                      "category": "contact_info",
                      "label": "Contact Information",
                      "order": 2,
                      "filters": [
                        {
                          "name": "email",
                          "label": "Email",
                          "type": "text",
                          "key": "fields_filter.email",
                          "options": {}
                        },
                        {
                          "name": "firstname",
                          "label": "First Name",
                          "type": "text",
                          "key": "fields_filter.first_name",
                          "options": {}
                        },
                        {
                          "name": "lastname",
                          "label": "Last Name",
                          "type": "text",
                          "key": "fields_filter.last_name",
                          "options": {}
                        },
                        {
                          "name": "address",
                          "label": "Address",
                          "type": "text",
                          "key": "fields_filter.address",
                          "options": {}
                        },
                        {
                          "name": "review",
                          "label": "Review",
                          "type": "review",
                          "key": "review_filter",
                          "options": {}
                        },
                        {
                          "name": "appointment_state",
                          "label": "Appointment Status",
                          "type": "multiselect",
                          "key": "appointment_filter.state",
                          "options": {
                            "values": [
                              {"id": "requested", "display_value": "Pending approval"},
                              {"id": "invited", "display_value": "Invited"},
                              {"id": "scheduled", "display_value": "Scheduled"},
                              {"id": "completed", "display_value": "Completed"},
                              {"id": "cancelled", "display_value": "Cancelled"},
                              {"id": "rejected", "display_value": "Declined"}
                            ]
                          }
                        }
                      ]
                    },
                    {
                      "category": "comm_details",
                      "label": "Communication Details",
                      "order": 3,
                      "filters": [
                        {
                          "name": "unsubscribed",
                          "label": "Unsubscribed from Campaigns",
                          "type": "boolean",
                          "key": "fields_filter.unsubscribed",
                          "options": {}
                        },
                        {
                          "name": "email_blocked",
                          "label": "Email Blocked",
                          "type": "boolean",
                          "key": "fields_filter.email_blocked",
                          "options": {}
                        }
                      ]
                    },
                    {
                      "category": "smart",
                      "label": "Smart Filters",
                      "order": 5,
                      "filters": [
                        {
                          "name": "has_open_payments",
                          "label": "Has Open Payments",
                          "type": "smart",
                          "key": "matter_metadata_flat.payments.open",
                          "options": {
                            "description": "Clients who have outstanding payments"
                          }
                        },
                        {
                          "name": "has_approved_estimates",
                          "label": "Has Approved Estimates",
                          "type": "smart",
                          "key": "matter_metadata_flat.estimates.approved",
                          "options": {
                            "description": "Clients with approved estimates"
                          }
                        },
                        {
                          "name": "has_pending_estimates",
                          "label": "Has Pending Estimates",
                          "type": "smart",
                          "key": "matter_metadata_flat.estimates.pending",
                          "options": {
                            "description": "Clients with pending estimates"
                          }
                        },
                        {
                          "name": "marked_as_followup",
                          "label": "Marked for Follow-up",
                          "type": "smart",
                          "key": "matter_metadata_flat.collaborator.followup.staff123",
                          "options": {
                            "description": "Clients marked for follow-up by staff"
                          }
                        },
                        {
                          "name": "has_upcoming_bookings",
                          "label": "Has Upcoming Bookings",
                          "type": "smart",
                          "key": "matter_metadata_flat.bookings.scheduled",
                          "options": {
                            "description": "Clients with scheduled appointments"
                          }
                        },
                        {
                          "name": "new_inquiries",
                          "label": "New Inquiries",
                          "type": "smart",
                          "key": "matter_metadata_flat.messages.new_lead",
                          "options": {
                            "description": "Clients who are new leads"
                          }
                        }
                      ]
                    }
                  ]
                }
              }
            }
          }
        },
        "security": [
          {
            "Bearer": []
          }
        ],
        "tags": ["View Filters"]
      }
    }
  }
}