{
  "basePath": "/client_api/v1",
  "host": "api.vcita.biz",
  "info": {
    "title": "client_api API",
    "version": "v2.0"
  },
  "paths": {
    "/portals/{business_uid}/contact/get_form": {
      "get": {
        "consumes": [
          "application/json"
        ],
        "description": "## Overview\nGets the leave details form of the business.\n\n## Authentication\n**Available for Client Tokens only.**",
        "parameters": [
          {
            "description": "business_uid",
            "in": "path",
            "name": "business_uid",
            "required": true,
            "type": "string"
          }
        ],
        "produces": [
          "application/json"
        ],
        "responses": {
          "200": {
            "description": "Success",
            "examples": {
              "application/json": {
                "data": {
                  "description": "Please fill out your details below so we can process your request.",
                  "sections": [
                    {
                      "description": "Please fill out your details below so we can process your request.",
                      "fields": [
                        [
                          {
                            "hidden": false,
                            "id": "subject",
                            "label": "Subject",
                            "required": true,
                            "type": "subject"
                          }
                        ],
                        [
                          {
                            "hidden": false,
                            "id": "message",
                            "label": "Message",
                            "required": true,
                            "type": "multiline"
                          }
                        ]
                      ],
                      "title": "",
                      "type": "message_info"
                    },
                    {
                      "description": "translation missing: en.settings.forms.leave_details.section.client_details.description",
                      "editable": true,
                      "fields": [
                        [
                          {
                            "default_value": "",
                            "id": "6tg9ode4uj2accvx",
                            "keep_asking": false,
                            "label": "email_label",
                            "object_type": "contact",
                            "required": true,
                            "type": "email"
                          }
                        ],
                        [
                          {
                            "default_value": "",
                            "id": "qkq65wh8577vio6q",
                            "keep_asking": false,
                            "label": "firstname_label",
                            "object_type": "contact",
                            "required": true,
                            "type": "firstname"
                          }
                        ]
                      ],
                      "title": "Client Info",
                      "type": "fields"
                    },
                    {
                      "description": "Enter a message you want your clients to read before they submit",
                      "fields": [
                        [
                          {
                            "default_value": "",
                            "enabled": false,
                            "label": "Business policy",
                            "type": "policy"
                          }
                        ]
                      ],
                      "title": "Business policy",
                      "type": "policies"
                    }
                  ],
                  "title": "Leave details form",
                  "type": "leave_details"
                },
                "status": "OK"
              }
            }
          }
        },
        "security": [
          {
            "default": [
              "client_api"
            ]
          }
        ],
        "summary": "Get Leave Details Form",
        "tags": [
          "Forms"
        ],
        "x-amazon-apigateway-auth": {
          "type": "NONE"
        },
        "x-amazon-apigateway-integration": {
          "httpMethod": "GET",
          "responses": {
            "default": {
              "statusCode": "200"
            }
          },
          "type": "http_proxy",
          "uri": "https:///client_api/v1/portals/{business_uid}/contact/get_form"
        },
        "x-auth-type": "Application & Application User"
      }
    },
    "/portals/{business_uid}/contact/submit": {
      "post": {
        "consumes": [
          "application/json"
        ],
        "description": "## Overview\nSubmits Leave Details Form to the business.\n\n## Authentication\n**Available for Client Tokens only.**\n\n## Required Fields\nBefore submitting, call `GET /client_api/v1/portals/{business_uid}/contact/get_form` to discover required fields for the business's form configuration.\n\nFor the default `leave_details` form, `subject` and `message` are typically required fields. Any field marked with `required: true` in the form response must be provided with a non-empty value, or the API returns HTTP 422.\n\n## Request Body Structure\nThe `form_data.fields` object is a dynamic map where keys are field IDs and values are the field values. Field IDs can be obtained from the GET form response.",
        "parameters": [
          {
            "description": "business_uid",
            "in": "path",
            "name": "business_uid",
            "required": true,
            "type": "string"
          },
          {
            "in": "body",
            "name": "body",
            "required": true,
            "schema": {
              "type": "object",
              "required": ["form_data"],
              "properties": {
                "form_data": {
                  "type": "object",
                  "required": ["fields"],
                  "description": "Form data containing field values. This is an object (NOT an array) with a 'fields' property.",
                  "properties": {
                    "fields": {
                      "type": "object",
                      "description": "Dynamic map of field IDs to values. Field IDs include fixed keys like 'subject' and 'message', plus any custom field IDs from the form configuration. Get valid field IDs from GET /client_api/v1/portals/{business_uid}/contact/get_form.",
                      "additionalProperties": {
                        "type": "string"
                      },
                      "example": {
                        "subject": "Contact inquiry",
                        "message": "Hello, I would like more information"
                      }
                    }
                  }
                },
                "source_data": {
                  "type": "object",
                  "properties": {
                    "isWidget": {
                      "description": "Whether the form was submitted from a widget. **Must be a boolean value (true/false), not a string.**",
                      "type": "boolean"
                    },
                    "o": {
                      "description": "The origin type in Base64",
                      "type": "string"
                    },
                    "s": {
                      "description": "The source url",
                      "type": "string"
                    },
                    "topUrl": {
                      "description": "The top url in Base64",
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        ],
        "produces": [
          "application/json"
        ],
        "responses": {
          "200": {
            "description": "Success",
            "examples": {
              "application/json": {
                "data": {
                  "auto_reply_message": null,
                  "conversation_uid": "ppnmz70yqxltzz6j",
                  "id": 22,
                  "token": "eyJhbGciOiJIUzI1NiJ9.eyJlbnRpdHlfdWlkIjoibzlkaTExdTd6dHU5NjFqOSIsImV4dHJhIjp7ImJ1c2luZXNzX3VpZCI6ImZiMGMyM2ZmN2UxNDI1NjgifSwiZXhwIjoxNzU2Nzk2MTkyLCJyZWZyZXNoIjoxNzU2Nzc2OTkyLCJjcmVhdGVkIjoxNzU0Mzc2OTkyLCJ0eXBlIjoiY2xpZW50IiwianRpIjoiMzg3NjAzNjY5MWY0YjY2M2Y2ZTk4MzM2MjA3MGM4NjZiYTdjOTg3YzVhYWRhMDgyMWVmNjQ0N2M4NTgzMjM2YyJ9.dGLJUl9kJd9G9F5h_CLEHO4oDCCTGXSEfKlOhJRP90o",
                  "uid": "xlc8czadb3tyag1k"
                },
                "status": "OK"
              }
            }
          },
          "422": {
            "description": "Validation Error - Empty or missing required fields. Use GET .../contact/get_form to discover required field IDs.",
            "examples": {
              "application/json": {
                "errors": [
                  {
                    "code": "invalid",
                    "field": "subject",
                    "message": "This field cannot be empty"
                  }
                ],
                "success": false
              }
            }
          }
        },
        "security": [
          {
            "default": [
              "client_api"
            ]
          }
        ],
        "summary": "Submits Leave Details Form",
        "tags": [
          "Forms"
        ],
        "x-amazon-apigateway-auth": {
          "type": "NONE"
        },
        "x-amazon-apigateway-integration": {
          "httpMethod": "POST",
          "responses": {
            "default": {
              "statusCode": "201"
            }
          },
          "type": "http_proxy",
          "uri": "https:///client_api/v1/portals/{business_uid}/contact/submit"
        },
        "x-auth-type": "Application & Application User"
      }
    },
    "/portals/{business_uid}/share_documents_form/get_form": {
      "get": {
        "consumes": [
          "application/json"
        ],
        "description": "## Overview\nGets the share documents form of the business.\n\n## Authentication\n**Available for Client Tokens only.**",
        "parameters": [
          {
            "in": "path",
            "name": "business_uid",
            "required": true,
            "type": "string"
          }
        ],
        "produces": [
          "application/json"
        ],
        "responses": {
          "200": {
            "description": "Share Documents Form",
            "examples": {
              "application/json": {
                "data": [
                  {
                    "description": "Please fill out your details below so we can process your request.",
                    "sections": [
                      {
                        "description": "Please fill out your details below so we can process your request.",
                        "fields": [
                          [
                            {
                              "id": "documents",
                              "label": "Select your files",
                              "required": true,
                              "type": "documents"
                            }
                          ],
                          [
                            {
                              "id": "title",
                              "label": "Document Title",
                              "required": false,
                              "type": "title"
                            }
                          ],
                          [
                            {
                              "id": "message",
                              "label": "Message",
                              "required": false,
                              "type": "multiline"
                            }
                          ]
                        ],
                        "title": "",
                        "type": "message_info"
                      },
                      {
                        "description": "Please fill out your details below so we can process your request.",
                        "editable": true,
                        "fields": [
                          {
                            "default_value": "",
                            "id": "0tq0ikpkf6amyo6",
                            "keep_asking": false,
                            "required": false,
                            "type": "singleline"
                          }
                        ],
                        "title": "",
                        "type": "fields"
                      },
                      {
                        "description": "Enter a message you want your clients to read before they submit",
                        "fields": [
                          {
                            "default_value": "",
                            "enabled": true,
                            "label": "Business policy",
                            "type": "policy"
                          }
                        ],
                        "title": "Business policy",
                        "type": "policies"
                      }
                    ],
                    "title": "Share documents form",
                    "type": "share_documents"
                  }
                ],
                "status": "OK"
              }
            }
          }
        },
        "security": [
          {
            "default": [
              "client_api"
            ]
          }
        ],
        "summary": "Get Share Documents Form",
        "tags": [
          "Forms"
        ],
        "x-amazon-apigateway-auth": {
          "type": "NONE"
        },
        "x-amazon-apigateway-integration": {
          "httpMethod": "GET",
          "responses": {
            "default": {
              "statusCode": "200"
            }
          },
          "type": "http_proxy",
          "uri": "https:///client_api/v1/portals/{business_uid}/share_documents_form/get_form"
        },
        "x-auth-type": "Application & Application User"
      }
    },
    "/portals/{business_uid}/share_documents_form/submit": {
      "post": {
        "description": "## Overview\nSubmits Share Documents Form to the business.\n\n## Authentication\n**Available for Client Tokens only.**\n\n## Critical Requirement\nThe `matter_uid` query parameter must reference a matter with an assigned staff member. Without this, the endpoint returns 500 due to a server-side bug.\n\n## Request Format\nThis endpoint requires `multipart/form-data` format with actual binary file uploads (not JSON). Documents must be uploaded as form fields with proper content types.\n\n## Important: Field Naming Convention\n**Document fields MUST use explicit numeric indices** (e.g., `[0]`, `[1]`), NOT empty brackets `[]`.\n\n- Correct: `form_data[fields][documents][0]=@file.pdf`\n- Wrong: `form_data[fields][documents][]=@file.pdf` (causes 500 error)\n\nThis is because the server expects a Hash structure, not an Array.\n\n## Captcha\nWhen the business has the `captcha_intake_form` feature enabled, a valid `captcha_token` is required.\n\n## Example cURL\n```bash\ncurl -X POST 'https://api.vcita.biz/client_api/v1/portals/{business_uid}/share_documents_form/submit?matter_uid={matter_uid}' \\\n  -H 'Authorization: Bearer {token}' \\\n  -F 'form_data[fields][title]=My Document' \\\n  -F 'form_data[fields][message]=Please review' \\\n  -F 'form_data[fields][documents][0]=@file.pdf;type=application/pdf'\n```",
        "parameters": [
          {
            "in": "path",
            "name": "business_uid",
            "required": true,
            "type": "string"
          },
          {
            "in": "query",
            "name": "matter_uid",
            "required": true,
            "type": "string",
            "description": "The matter/conversation UID to associate with the document upload. **Critical**: The matter must have an assigned staff member to avoid 500 errors."
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "required": ["form_data[fields][documents][0]"],
                "properties": {
                  "form_data[fields][title]": {
                    "type": "string",
                    "description": "Document title"
                  },
                  "form_data[fields][message]": {
                    "type": "string",
                    "description": "Message accompanying the documents"
                  },
                  "form_data[fields][documents][0]": {
                    "type": "string",
                    "format": "binary",
                    "description": "File to upload. **Important**: Use explicit indices `[0]`, `[1]`, etc. - NOT empty brackets `[]`. For multiple files, use `form_data[fields][documents][0]`, `form_data[fields][documents][1]`, etc."
                  },
                  "captcha_token": {
                    "type": "string",
                    "description": "reCAPTCHA token. Required when business has captcha_intake_form feature enabled."
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Success - Documents submitted successfully.",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "id": 142055507,
                    "uid": "gpybls1zgpmono0o",
                    "conversation_uid": "hf3gtvitw2ycg3ix",
                    "auto_reply_message": "Thank you for your message."
                  },
                  "status": "OK"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error or Business Blocked.\n\n**Validation Error**: Missing required fields like documents.\n\n**Business Blocked**: When the business is flagged as spammer or user access is blocked, returns 422 with NO explicit error message - only `auto_reply_message` in the data object. This \"silent error\" makes it impossible to diagnose the failure from the response alone.\n\n**Triggers for silent 422**:\n- Business is marked as spammer (rate limiting)\n- User access is blocked\n- Message contains spam keywords",
            "content": {
              "application/json": {
                "examples": {
                  "validation_error": {
                    "value": {
                      "errors": [
                        {
                          "code": "invalid",
                          "field": "documents",
                          "message": "Documents are required"
                        }
                      ],
                      "success": false
                    }
                  },
                  "business_blocked_silent_error": {
                    "value": {
                      "status": "Error",
                      "data": {
                        "auto_reply_message": "Thank you for your message."
                      }
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error.\n\n**Bug 1: Empty JSON Body**\nSending `Content-Type: application/json` with `{}` body causes nil access error.\n\n**Bug 2: Missing Staff on Matter**\nOccurs when the matter does not have an assigned staff member. The server accesses `conversation.staff.can_receive_sms?` without nil-checking.\n\n**Workaround**: Ensure the `matter_uid` parameter references a matter with an assigned staff member. Use `PUT /business/clients/v1/matters/{matter_uid}/reassign` to assign staff before calling this endpoint.",
            "content": {
              "application/json": {
                "examples": {
                  "empty_body_error": {
                    "value": {
                      "error": "undefined method `[]' for nil:NilClass",
                      "status": "Error"
                    }
                  },
                  "nil_staff_error": {
                    "value": {
                      "error": "undefined method `can_receive_sms?' for nil:NilClass",
                      "status": "Error"
                    }
                  }
                }
              }
            }
          }
        },
        "security": [
          {
            "default": [
              "client_api"
            ]
          }
        ],
        "summary": "Submits Share Documents Form",
        "tags": [
          "Forms"
        ],
        "x-amazon-apigateway-auth": {
          "type": "NONE"
        },
        "x-amazon-apigateway-integration": {
          "httpMethod": "POST",
          "responses": {
            "default": {
              "statusCode": "200"
            }
          },
          "type": "http_proxy",
          "uri": "https:///client_api/v1/portals/{business_uid}/share_documents_form/submit"
        },
        "x-auth-type": "Application & Application User"
      }
    }
  },
  "securityDefinitions": {
    "default": {
      "authorizationUrl": "https://ignore.myclients.io",
      "flow": "implicit",
      "scopes": {
        "client_api": "All client_api related operations",
        "client_api_create": "client_api create scope",
        "client_api_delete": "client_api delete scope",
        "client_api_read": "client_api read scope",
        "client_api_update": "client_api update scope"
      },
      "type": "oauth2",
      "x-scopes-bindings": {
        "client_api": "",
        "client_api_create": "",
        "client_api_delete": "",
        "client_api_read": "",
        "client_api_update": ""
      }
    }
  },
  "swagger": "2.0",
  "x-throttling-tier": "8ReqPerSec",
  "components": {
    "securitySchemes": {
      "Bearer": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "description": "Provide a valid bearer token in the Authorization header. Example: 'Authorization: Bearer {app_token}'"
      }
    }
  }
}
