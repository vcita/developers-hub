{
  "type": "object",
  "definitions": {
    "lineItem": {
      "type": "object",
      "description": "A line item refers to each billable item in the invoice. Invoice total amount will be a sum of all line items. A line item can be added nested under a line items group, or independently in the invoice (not nested)",
      "properties": {
        "name": {
          "type": "string",
          "description": "Line item name/title"
        },
        "quantity": {
          "type": "number",
          "description": "Line item quantity"
        },
        "unit_amount": {
          "type": "number",
          "description": "Unit price/amount"
        },
        "description": {
          "type": "string",
          "description": "Line item description"
        },
        "entity_uid": {
          "type": "string",
          "description": "UID of related entity (service/product/package)"
        },
        "entity_type": {
          "type": "string",
          "enum": ["Meeting", "EventAttendance", "ProductOrder", "ClientBookingPackage", "Service", "Product", "BookingPackage"],
          "description": "Type of related entity. If custom item → NULL"
        },
        "uid": {
          "type": "string",
          "description": "Line item UID (for updates)"
        },
        "tax_uids": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Array of tax UIDs to apply. Pulled from the taxes set in the business Taxes settings. 0-3 taxes per line item are allowed"
        },
        "discount": {
          "type": "object",
          "description": "Line item discount. Can be a percentage or a fixed amount to be reduced from the line item amount",
          "properties": {
            "discount_type": {
              "type": "string",
              "enum": ["percent", "amount"],
              "description": "Type of discount: percentage or fixed amount"
            },
            "amount": {
              "type": "number",
              "description": "Discount value. If discount_type is 'percent', this is the percentage (e.g., 10 for 10%). If discount_type is 'amount', this is the fixed discount amount"
            }
          },
          "required": ["discount_type", "amount"]
        },
        "line_item_index": {
          "type": "number",
          "description": "Line item position/index"
        }
      },
      "required": ["name", "quantity", "unit_amount"]
    }
  },
  "properties": {
    "uid": {
      "type": "string",
      "description": "The invoice's unique identifier"
    },
    "created_at": {
      "type": "string",
      "format": "date-time",
      "description": "Created date and time"
    },
    "updated_at": {
      "type": "string",
      "format": "date-time",
      "description": "Updated date and time"
    },
    "matter_uid": {
      "type": "string",
      "description": "Matter UID. The identify number of the client that the invoice for issued for"
    },
    "issue_date": {
      "type": "string",
      "format": "date",
      "description": "The date the invoice was issued. Issue_date >=Today()"
    },
    "due_date": {
      "type": "string",
      "format": "date",
      "description": "Invoice due date. Expected date for payment. Must be >= issue_date"
    },
    "currency": {
      "type": "string",
      "description": "Three-letter ISO currency code (e.g., \"USD\", \"ILS\")"
    },
    "status": {
      "type": "string",
      "enum": ["DRAFT", "ISSUED", "CANCELLED"],
      "description": "Invoice statuses (Draft, Issued, Cancelled). Draft: refers to the initial editable stage of the invoice. Issued: Invoice was issued. (in Strict mode: Invoice is immune and cannot be edited. Cancelled: Cancelled invoices: In strict mode: Can be performed only from \"Draft\" state. In Flex mode: Issued to Cancelled is allowed. Required field: \"DRAFT\" or \"ISSUED\" or \"CANCELLED\" (default: \"ISSUED\")"
    },
    "unique_number": {
      "type": "string",
      "description": "Invoice unique, sequential number.\nTwo types of numbering:\n1. Unique sequence of numbers (1,2,3….)\n2. A yearly repeated numbering including a year's prefix (2025-0001, 2025-0002…). Within each year start - rounding the count (2026-0001, 2026-0002,…).\nOptional, auto-generated if not provided"
    },
    "invoice_title": {
      "type": "string",
      "description": "Invoice title. A document title to appear on top of the PDF. Optional. Default: \"INVOICE\""
    },
    "billing_address": {
      "type": "string",
      "description": "Full business billing address, including street, city, state, country, and zipcode"
    },
    "purchase_order": {
      "type": "string",
      "description": "Purchase order number"
    },
    "allow_online_payment": {
      "type": "boolean",
      "description": "Enable online payment for this specific invoice (allow the client to pay directly from the client portal)"
    },
    "allow_partial_payment": {
      "type": "boolean",
      "description": "Enable partial payment for this specific invoice (allow the client to pay a portion of the invoice amount rather than its full due price)"
    },
    "enable_late_fee": {
      "type": "boolean",
      "description": "Enable late fee on invoice for this specific invoice. (late fee will be added to the invoice automatically when the invoice will become overdue. Not applicable in strict mode where an invoice is a legal binding document and cannot be edited)"
    },
    "note": {
      "type": "string",
      "description": "Invoice notes/comments appears in the invoice document"
    },
    "terms_and_conditions": {
      "type": "string",
      "description": "Payment terms and conditions. appears in the invoice document"
    },
    "additional_recipients": {
      "type": "array",
      "items": {
        "type": "string",
        "format": "email"
      },
      "description": "CC email recipients (array of email strings). comma separated"
    },
    "line_item_groups": {
      "type": "array",
      "description": "Array of invoice line item groups. Line item groups allows to group invoice line items per need, while each line item group will have at least a single line item set in it. Optional, used when `add_item_header` feature flag is enabled",
      "minItems": 1,
      "items": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "description": "Section name"
          },
          "line_item_group_index": {
            "type": "number",
            "description": "Section order/index"
          },
          "line_items": {
            "type": "array",
            "description": "Array of line items within this section",
            "minItems": 1,
            "items": {
              "$ref": "#/definitions/lineItem"
            }
          }
        },
        "required": ["name", "line_item_group_index", "line_items"]
      }
    },
    "display_line_item_groups_total": {
      "type": "boolean",
      "description": "Display the total price of the items that are nested under a line items group"
    },
    "display_line_item_total": {
      "type": "boolean",
      "description": "Display nested under a group line item price"
    },
    "estimate_uid": {
      "type": "string",
      "description": "The unique identifier of the estimate from which invoice was created"
    },
    "line_items": {
      "type": "array",
      "description": "Array of invoice line items. Line items that are not part of the line item groups. Required if line_item_groups not provided, at least one line item required",
      "minItems": 1,
      "items": {
        "$ref": "#/definitions/lineItem"
      }
    },
    "payment_status_uid": {
      "type": "string",
      "description": "The identified number of the payment request that is associated with the invoice"
    },
    "net_total": {
      "type": "number",
      "description": "The invoice total amount exclude taxes"
    },
    "grand_total": {
      "type": "number",
      "description": "The invoice total amount including taxes"
    },
    "taxes": {
      "type": "number",
      "description": "The total taxes amount as calculated per the invoice line items amount"
    }
  },
  "anyOf": [
    {
      "required": [
        "matter_uid",
        "issue_date",
        "due_date",
        "currency",
        "line_items"
      ]
    },
      {
        "required": [
          "matter_uid",
          "issue_date",
          "due_date",
          "currency",
          "line_item_groups"
        ]
      }
  ],
  "readOnly": [
    "uid",
    "created_at",
    "updated_at",
    "payment_status_uid",
    "net_total",
    "grand_total",
    "taxes"
  ],
  "example": {
    "uid": "inv-aaabbbccc112233",
    "created_at": "2024-01-15T10:00:00.000Z",
    "updated_at": "2024-01-15T10:00:00.000Z",
    "matter_uid": "matter_123",
    "issue_date": "2024-01-15",
    "due_date": "2024-02-15",
    "currency": "USD",
    "status": "ISSUED",
    "unique_number": "2024-0001",
    "invoice_title": "INVOICE",
    "billing_address": "123 Main St, City, State 12345",
    "purchase_order": "PO-12345",
    "allow_online_payment": true,
    "allow_partial_payment": false,
    "enable_late_fee": false,
    "note": "Thank you for your business",
    "terms_and_conditions": "Payment due within 30 days",
    "additional_recipients": ["accounting@example.com"],
    "display_line_item_groups_total": true,
    "display_line_item_total": true,
    "estimate_uid": null,
    "line_item_groups": [
      {
        "name": "Services",
        "line_item_group_index": 0,
        "line_items": [
          {
            "name": "Consulting Services",
            "quantity": 2,
            "unit_amount": 150.00,
            "description": "Hourly consulting",
            "entity_uid": "service_123",
            "entity_type": "Service",
            "tax_uids": ["tax_uid_1"],
            "discount": {
              "discount_type": "percent",
              "amount": 10
            },
            "line_item_index": 0
          }
        ]
      }
    ],
    "line_items": [
      {
        "name": "Design materials",
        "quantity": 1,
        "unit_amount": 114.00,
        "description": "Design materials",
        "entity_uid": "product_123",
        "entity_type": "Product",
        "tax_uids": ["tax_uid_1"],
        "discount": null,
        "line_item_index": 1
      }
    ]
  },
  "description": "Invoice entity representing a bill or invoice document with line items, payment terms, and client information."
}

